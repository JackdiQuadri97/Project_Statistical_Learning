---
title: ''
author: ''
output:
  pdf_document: default
---

\begin{center}

\huge
University of Padua

\huge
Departments of Mathematics

\vspace{1cm}

\huge
Master Degree in Data Science

\vspace{1.5cm}

\includegraphics[width=2in]{logo_unipd.png}

\vspace{1cm}

\Huge
Low-Carbon Electricity Generation: \\A Comprehensive Analysis

\vspace{1.5cm}

\Large
Valerio Rocca, 2094861

\Large
Giacomo Virginio, 2076681

\vspace{1.5cm}

\huge
Academic Year 2022/2023

\end{center}

\newpage

\setcounter{page}{1}

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(viridis)
library(rworldmap)
 library(glmnet) #To check if it's necessary
library(readxl)
library(gridExtra)
library(corrplot)
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
options(dplyr.summarise.inform = FALSE)
options(countrycode_warning = FALSE)
options(dplyr.print_max = Inf)
suppressMessages(library(ggplot2))
suppressMessages(library(rworldmap))

```
\Large
\textbf{Contents}

\vspace{0.5cm}

\small

\begin{tabular}{l@{\hskip 27em}r}

\textbf{Abstract} & \textbf{2} \\

1. \textbf{Obtaining data} & \textbf{3} \\

2. \textbf{Data pre-processing} & \textbf{X} \\

3. \textbf{Exploratory analyses} & \textbf{X} \\

4. \textbf{Descriptive analyses} & \textbf{X} \\
\hspace{1em} 4.1 Global analyses & X \\
\hspace{1em} 4.2 Analyses by source & X \\
\hspace{1em} 4.3 Analyses by macroregion & X \\
\hspace{1em} 4.4 Green Score with focus on the sources & X \\
\hspace{1em} 4.5 Green Score with focus on the macroregions & X \\

5. \textbf{Modeling} & \textbf{X} \\

\textbf{Sitography} & \textbf{X} \\

\end{tabular}

\newpage

# Abstract
This report presents a comprehensive analysis of low-carbon electricity generation, focusing on its history, current trends, and future prospects.

The analysis begins by examining quantitatively the historical context of low-carbon electricity generation, tracing its origins and evolution over time and by proposing insights on different sources and world areas.

Next, the report delves into the current trends and status of low-carbon electricity generation. By exploiting a tailored yet simple measure, the Green Score, it provides a detailed overview of various sources such as nuclear, solar, wind, and hydropower, along with their contributions to the global energy mix.

Parte di Giacomo

\newpage

# Chapter 1
# Obtaining data
We could not find a single dataset containing all the information of interest. Thus, the project's first step is merging multiple datasets into one. The primary one is the *Energy dataset* by Our World in Data (from now onwards referred to as "OWID") [1], which contains various time series for each world country regarding energy and electricity production and consumption.

```{r obtain_energy, include=TRUE, warning = FALSE}

# Import the Energy dataset
main = read.csv("datasets//Total_energy_data.csv")
```
We then merge the following datasets into it:

- *GDP (constant 2015 US$)* by World Bank [2], which contains the time series of the GDP in each country from 1960 to 2021, measured in constant 2015 USA dollars.
- *Land Area* by OWID [3], which contains the time series of the land area of each country from 1961 to 2021, measured in squared kilometers;
- *Agricultural land* by OWID [4], which contains the time series of the share of land area used for agriculture in each country from 1961 to 2018;
- *Urbanization rate* by OWID [5], which contains the time series of the share of people living in urban areas in each country from 1960 to 2020;
- *Human Development Index* by OWID [6], which contains the time series of the HDI for each country from 1990 to 2021;
- *Death rate from air pollution* by OWID [7], which after filtering contains the time series of the number of deaths from outdoor particulate matter per 100,000 population in each country from 1990 to 2019;
- *Coal proved reserves* by OWID [8], which contains the reserves of coal in each country in 2021, measured in tonnes;
- *Oil proved reserves* by OWID [9], which contains the reserves of oil in each country in 2020, measured in tonnes;
- *Natural gas proved reserves* by OWID [10], which contains the time series of the reserves of natural gas in each country from 1980 to 2020 (CHECK BC THE LINK HAS ONLY 2020);
- *Uranium proved reserves* by OECD [11], which contains uranium reserves in each country in 2019, measured in tonnes.

Merging presents three critical issues listed below, together with the implemented solutions.

1. Time series are recorded for different years. We tackled this problem by merging through left join: all the rows of the *Energy dataset* are included, while rows from the other datasets are included if there is a match; otherwise, a NA value is added. In order to perform correctly the left join, we need to remove the countries in the *Energy dataset* without an ISO code. This is the case for some semi-autonomous territories inside of a country (e.g., Wake Island), countries that no longer exist (e.g., Yugoslavia), and country groupings (e.g., OPEC countries). Therefore, we decide to remove those observations.
2. Coal, oil, and uranium reserves are stationary values, as time series for those variables are not publicly available. Therefore, we approached the issue by considering the reserves fixed through time, as it does not affect the quality of the analyses.
3. *GDP (constant 2015 US$)* dataset contains a column for each year, while the other time series datasets format the years using a specific variable. Therefore, we modify the structure of *GDP* to fit the others'.

```{r obtain_data, include=TRUE, warning = FALSE}

# Delete units from "main" without an ISO code
main = main[main$iso_code!='',]

# Creation of a function able to automatically join datasets from OWID
join_owid = function(main_data, secondary_dataset_link){
  place_data = read.csv(paste(secondary_dataset_link))
  main_data = left_join(main_data, select(place_data, -c("Entity")),
                 by = c("iso_code" = "Code", "year" = "Year"))
  rm(place_data)
  return(main_data)
}

# Import and merging of OWID variables country area, HDI and urbanization rate
main = join_owid(main, "datasets//country_areas.csv")
main = join_owid(main, "datasets//human_development_index.csv")
main = join_owid(main, "datasets//urbanization_rate.csv")

# Import, selection and merging of deaths from air pollution
 death_rates = read.csv("datasets//death_rates_from_air_pollution.csv")[, c(2,3,5)]
 colnames(death_rates) = c("Code", "Year", "particulate_pollution")
 main = left_join(main, death_rates,
                  by = c("iso_code" = "Code", "year" = "Year"))
rm(death_rates)

# Import and merging share of land for for agricultural use
main = join_owid(main, "datasets//share_of_land_area_used_for_agriculture.csv")


# Import, filtering and merging of coal proved reserves
coal_res = read.csv("datasets//coal_proved_reserves.csv")
coal_res = coal_res[coal_res$Year!="2020",]
colnames(coal_res) = c("Entity", "Code", "Year", "coal_reserves_2021")
main = left_join(main, select(coal_res, -c("Entity","Year")),
                 by = c("iso_code" = "Code"))
rm(coal_res)

# Import and merging oil proved reserves
main = join_owid(main, "datasets//oil_proved_reserves.csv")

# Import and merging of uranium reserves
uranium_res = read.csv("datasets//uranium_proved_reserves.txt", sep = "\t")
colnames(uranium_res) = c("V1","V2", "uranium_reserves_2019", "V4")
uranium_res$uranium_reserves_2019 = as.numeric(gsub(",","",uranium_res$uranium_reserves_2019))
uranium_res$V1 = sub(".","",uranium_res$V1)
main = left_join(main, select(uranium_res, -c("V2", "V4")),
                 by = c("country" = "V1"))
rm(uranium_res)

# Import and merging natural gas proved reserves
main = join_owid(main, "datasets//natural_gas_proved_reserves.csv")

# Import the GDP dataset
gdp = read_excel("datasets//gdp_constant_2015_dollars.xlsx")[,4:66]
# Structure modification
colnames(gdp) = c("code", 1960:2021)
gdp = gather(gdp, key = "year", value = "gdp", -code)
gdp$year = as.integer(gdp$year)
# Merging
main = left_join(main, gdp, by = c("iso_code" = "code", "year" = "year"))
rm(gdp)


```
\newpage


# Chapter 2
# Data pre-processing

In this section, we present the pre-processing activities performed.

1. **Units selection**, computed over the *Energy dataset*. Already partially computed and explained in the previous section, in this phase we also removed two regions with too many missing values: Antarctica and Western Sahara.
2. **Feature selection**, computed over the *Energy dataset*. From the original 129 variables, we kept only 36 relevant for the analyses.
3. **Feature renaming**, computed over *main*, as the features merged to the *Energy dataset* have inconvenient names.
4. **Feature addition**, computed over *main* in paragraph 4.3. The new categorical variable groups the world countries into six macroregions.
4. **Cleaning NA and 0 values**, with the substitution of NA for reserves data to 0 and of '..' to NA for GDP


```{r data_preproc, include=TRUE, warning = FALSE}

# 1. Units selection: remove Antarctica and Western Sahara
main = filter(main, iso_code != "ATA", iso_code != "ESH")

# 2. Feature selection
main = select(main, -c("gdp.x", "biofuel_cons_change_pct",
                       "biofuel_cons_change_twh", "biofuel_cons_per_capita",
                       "biofuel_elec_per_capita", "biofuel_consumption",
                       "biofuel_electricity", "biofuel_share_elec",
                       "biofuel_share_energy", "coal_cons_change_pct",
                       "coal_cons_change_twh", "coal_cons_per_capita",
                       "coal_elec_per_capita", "coal_prod_change_pct",
                       "coal_prod_change_twh", "coal_prod_per_capita",
                       "coal_consumption", "coal_share_energy",
                       "energy_cons_change_pct", "energy_per_capita",
                       "energy_per_gdp", "electricity_share_energy",
                       "fossil_cons_change_pct", "fossil_cons_change_twh",
                       "fossil_elec_per_capita", "fossil_fuel_consumption",
                       "fossil_share_energy", "gas_cons_change_pct",
                       "gas_cons_change_twh", "gas_elec_per_capita",
                       "gas_prod_change_pct", "gas_prod_change_twh",
                       "gas_prod_per_capita", "gas_consumption",
                       "gas_share_energy", "hydro_cons_change_pct",
                       "hydro_cons_change_twh", "hydro_elec_per_capita",
                       "fossil_energy_per_capita", "hydro_energy_per_capita",
                       "hydro_consumption", "hydro_share_energy",
                       "low_carbon_cons_change_pct", "low_carbon_cons_change_twh",
                       "low_carbon_elec_per_capita", "low_carbon_energy_per_capita",
                       "low_carbon_consumption", "low_carbon_share_energy",
                       "net_elec_imports_share_demand", "nuclear_cons_change_pct",
                       "nuclear_cons_change_twh", "nuclear_elec_per_capita",
                       "nuclear_energy_per_capita", "nuclear_consumption",
                       "nuclear_share_energy", "oil_prod_per_capita",
                       "gas_energy_per_capita", "oil_elec_per_capita",
                       "oil_prod_change_pct", "oil_prod_change_twh",
                       "oil_consumption", "oil_share_energy",
                       "other_renewable_exc_biofuel_electricity", "other_renewables_cons_change_pct",
                       "other_renewables_cons_change_twh", "other_renewables_elec_per_capita",
                       "other_renewables_elec_per_capita_exc_biofuel",
                       "other_renewables_energy_per_capita",
                       "other_renewables_share_elec_exc_biofuel", "other_renewable_consumption",
                       "other_renewables_share_energy", "per_capita_electricity",
                       "renewables_cons_change_pct", "renewables_cons_change_twh",
                       "renewables_elec_per_capita", "renewables_energy_per_capita",
                       "renewables_consumption", "renewables_share_energy",
                       "solar_cons_change_pct", "solar_cons_change_twh",
                       "solar_elec_per_capita", "solar_consumption",
                       "solar_share_energy", "wind_cons_change_pct",
                       "wind_cons_change_twh", "wind_consumption",
                       "wind_share_energy", "solar_energy_per_capita",
                       "wind_elec_per_capita", "wind_energy_per_capita",
                       "oil_cons_change_pct", "oil_cons_change_twh",
                       "oil_energy_per_capita"))

# 3. Feature renaming
colnames(main) = c(colnames(main[,1:36]), "land_area", "hdi", "urbaniz_rate",
                           "particulate_pollution", "agri_land_rate",
                           "coal_reserves_2021", "oil_reserves_2020",
                           "uranium_reserves_2019","gas_reserves", "gdp")

# 4. Cleaning NA and 0 values
main = main %>% mutate(
  oil_reserves_2020 = coalesce(oil_reserves_2020, 0),
  uranium_reserves_2019 = coalesce(uranium_reserves_2019, 0),
  gas_reserves = coalesce(gas_reserves, 0),
  coal_reserves_2021 = coalesce(coal_reserves_2021, 0))

main = mutate(main, gdp = na_if(gdp, ".."))
main$gdp = as.numeric(main$gdp)

```
\newpage

# Chapter 3
# Exploratory analyses
### 3.1 Global exploratory analyses
The first step of exploratory analysis will be getting the summary of our dataset and describe each feature.

```{r explorative_1, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
summary(main)
```

Each unit represent a country in a given year, the dataset has two character variables, country and ISO code, and 45 numerical variables.

Of these 45, 10 are the ones presented in the data obtaining step, while the other 35 belong to the initial energy dataset and are the following:

- **Year** and **Population**;
- Pollution measurements: **Carbon intensity of electricity** (which measures how many grams of CO2 are release to produce a kWh of electricity) and **Greenhouse gas emissions**;
- Overall energy and electricity measurements: **Electricity demand** (which is the amount of electricity consumed), **Electricity generation** (the amount of electricity produced), **Energy consumption change in tWh** (change in energy consumed compared to the previous year), **Net electricity imports** (electricity imported minus electricity exported for the country) and **Primary energy consumption** (Energy consumed by the country);
- Variables related to electricity consumption and production for each source: renewables, that are divided in hydro, solar, wind, other renewables; fossil, divided in coal, oil and gas; and finally low carbon, which is the aggregation of renewables with nuclear. For each source the dataset presents a variable for **electricity production** and **share of electricity production**, and for each single fossil source the **production** is also present.

The following is the distribution of units by Year:
```{r explorative_2, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
ggplot(main, aes(x = year)) + geom_histogram(bins = 123) + ggtitle(paste("year distribution"))
```

### 3.2 Variable transformation
Then we can explore more in depth each variable by plotting their distribution and, since for some years the dataset is very sparse, by viewing the percentage of NA values for each variables, by Year.

However, as it could already be noticed in the summaries, the data is very skewed and has many outliers, as can be seen by plotting for Population.
```{r explorative_3, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
i=4
i1 <- colnames(main)[i]
p11 <- ggplot(main, aes_string(x = i1)) + geom_histogram(bins = 100) + ggtitle(paste(i1, " distribution"))
nacount = main %>%
  group_by(year) %>%
  summarize(na_perc = sum(is.na(!!sym(i1)))/n())
p12 <- ggplot(nacount, aes(x = year, y = na_perc)) + geom_line() + ylim(0, 1) + ggtitle("NA% by Year")
grid.arrange(p11, p12, widths = c(0.6, 0.4), ncol = 2)
```

Therefore we decided to transform data for exploratory analysis, first by dividing to all variables, except HDI, not representing a share (e.g. hydro share of electricity, urbanization rate) by the population (as millions of inhabitants), then by applying a logarithm transformation to population, land area, GDP and the four reserves variables.
Also, we create a subset of our dataset containing data from a single year, 2016.
```{r explorative_4, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
# analisi con logaritmi e procapite(million)
cols_pc <- c(6,7,9,10,11,12,14,15,17,18,20,22,23,25,26,28,29,30,31,33,35,37,42,43,44,45,46)
cols_log <- c(4, 37, 42, 43, 44, 45, 46)

mainlog <- main %>% mutate(across(all_of(cols_pc), .fns = ~.*1000000/population))
mainlog <- mainlog %>% mutate(across(all_of(c(cols_log)), .fns = ~ log(.+1)))

#single year visualization, 2016
mainlog2016 = mainlog[mainlog$year==2016,]
```


### 3.3 Plotting function and division in groups
As we have many variables, we write a function to plot for a given variable it's distribution, it's distribution only for the year 2016, and it's NA percentage by Year; the function also prints the three countries with the highest measurement for the variable in 2016.
```{r explorative_5, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
do_plots = function(i){
  i1 = colnames(mainlog)[i]
  x_min <- min(mainlog[i1], na.rm=TRUE)
  x_max <- max(mainlog[i1], na.rm=TRUE)
  x_diff <- x_max-x_min
  p11 = ggplot(mainlog, aes_string(x = i1)) + geom_histogram(bins = 25) + ggtitle(paste(i1, " distribution")) + xlim(x_min-x_diff/25, x_max+x_diff/25)
  p12 = ggplot(mainlog2016, aes_string(x = i1)) + geom_histogram(bins = 25) + ggtitle("2016 distribution") + xlim(x_min-x_diff/25, x_max+x_diff/25)
  nacount = mainlog %>%
    group_by(year) %>%
    summarize(na_perc = sum(is.na(!!sym(i1)))/n())
  p13 = ggplot(nacount, aes(x = year, y = na_perc)) + geom_line() + ylim(0, 1) + ggtitle("NA% by Year")
  grid.arrange(p11, p12, p13, widths = c(3,3,2), ncol = 3)
  i1_ord = mainlog2016[order(mainlog2016[i1], decreasing=TRUE),1]
  print(paste("Top three countries in 2016 for",i1,":", i1_ord[1], ",", i1_ord[2], ",", i1_ord[3]))
}
```

We can plot again for Population, and we can now see population has a log-normal distribution, for 2016 it is similarly distributed, with an overall shift to the right.
```{r explorative_6, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
do_plots(4)
```

To make the exploration easier and more intuitive we divide variables in five groups, each containing:
1. Variables pertaining to the reserves;
2. Variables that regard low carbon sources;
3. Variables regarding high carbon (fossil) sources;
4. Other variables that belonged to the Energy dataset, which are variables in that dataset not about a specific source;
5. Other variables that didn't belong to the Energy dataset.
```{r explorative_7, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
other_measures = c(5,17,9,10,11,22,30)
reserves = c(42,43,44,45)
ext_measures = c(37,38,39,40,41,46)
lowcarb = c(18,19,33,34,35,36,28,29,31,32,23,24,20,21)
highcarb = c(6,7,8,14,15,16,25,26,27,12,13)
```

Now we'll plot using the function we created for each group, and we'll also plot the correlation between variables inside each group.

### 3.4 Analysis on Energy dataset non source specific
First we observe the variables in the Energy dataset not specific to any source:
```{r explorative_8, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
for (i in other_measures){
  do_plots(i)
}
corrplot(cor(mainlog[,other_measures], use="pairwise.complete.obs"), method="color", tl.cex = .5)
corrplot(cor(mainlog2016[,other_measures], use="pairwise.complete.obs"), method="color", tl.cex = .5)
```

From the NA% plot we can notice that some variables are only recorded since the year 2000, which is an important consideration especially when we will build the models.

There is a noticeable difference between **carbon intensity of electricity** and **greenhouse gas emissions** (even tho the two have a slight positive correlation) the first one has a distribution similar to a gaussian, with left skewing, while the second looks more like a log-gaussian, but the most important difference can be noticed in the countries with the highest measurements: carbon intensity in fact measures only the CO2 pollution from electricity, with some small countries being the highest pollutors (for each kWh), with these countries probably fully relying on coal for electricity production; greenhouse gas emissions instead consider the emissions made during energy generation, so it considers also primary energy, the contries with the highest scores are oil producers from middle east.
Also **Primary energy consumption** is correlated to greenhouse gas emissions, but not to carbon intensity of electricity.

The countries with highest **electricity demands and generation** (two measurements that are almost collinear, as expected), are, apparently, rich countries that are either very cold or very hot.

### 3.5 Analysis on Energy dataset for fossil sources
```{r explorative_9, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
for (i in highcarb){
  do_plots(i)
}
corrplot(cor(mainlog[,highcarb], use="pairwise.complete.obs"), method="color", tl.cex = .5)
corrplot(cor(mainlog2016[,highcarb], use="pairwise.complete.obs"), method="color", tl.cex = .5)
```

Moving on to fossil sources we can notice that **oil** overall is the most used source, but curiously oil **production** and **electricity** from oil are not correlated (and even have a negative correlation when considering share of electricity), while instead **coal** and **gas** have a strong correlation, meaning countries that use them tend to be producers, while the same can't be said for **oil**.

Comparing the graphs with all years vs 2016 we can notice a very slight decrease overtime of use for all fossil sources.

### 3.6 Analysis on Energy dataset for low carbon sources
```{r explorative_10, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
for (i in lowcarb){
  do_plots(i)
}
corrplot(cor(mainlog[,lowcarb], use="pairwise.complete.obs"), method="color", tl.cex = .5)
corrplot(cor(mainlog2016[,lowcarb], use="pairwise.complete.obs"), method="color", tl.cex = .5)

```

For **low carbon sources**, again we see that most countries are sharing records only from year 2000 onwards.

Electricity from low carbon sources is manly coming from **hydro**, with all other sources having distributions close to 0, with some big outliers, in fact hydro is almost collinear with overall electricity production and share for renewables and low carbo, this is because hydro is historically the most used renewable source, was extremely cheap when compared to the other low carbon sources, and also had a different purpose than electricity production.

**Solar** and **Wind** are correlated, however the correlation has gotten weaker over time, this is probably due to the cost of the sources, which came down over the years, so it is feasible for more countries to invest in renewable sources and to do so in the one that best fits the country availability.

### 3.7 Analysis on external reserves variables
```{r explorative_11, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
for (i in reserves){
  do_plots(i)
}
corrplot(cor(mainlog2016[,reserves], use="pairwise.complete.obs"), method="color", tl.cex = .5)
```

The plots for reserves don't offer many insight other than the fact that most countries don't have reserves, the distribution between countries that have reserves is normal (after transformation); there also is correlation among the different types of reserves.

### 3.8 Analysis on other external variables
```{r explorative_12, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
for (i in ext_measures){
  do_plots(i)
}
corrplot(cor(mainlog[,ext_measures], use="pairwise.complete.obs"), method="color", tl.cex = .5)
corrplot(cor(mainlog2016[,ext_measures], use="pairwise.complete.obs"), method="color", tl.cex = .5)

```

Other variables external from the Energy dataset all have a distribution similar to a gaussian (after the applied transformations).

As expected **GDP** and **HDI** are strongly correlated, and urbanization rate also has a good correlation with those two variables, while all three are slightly negatively correlated to **land area** and **agricultural land rate**; **particulate pollution** is not correlated to any other variables.

### 3.9 Inter-groups correlations
```{r explorative_13, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
subsetdf = mainlog[,c(2,other_measures,highcarb,lowcarb,reserves,ext_measures)] 
subsetdf2016 = mainlog2016[,c(other_measures,highcarb,lowcarb,reserves,ext_measures)]

corrplot(cor(subsetdf, use="pairwise.complete.obs"), method="color", tl.cex = .3)
corrplot(cor(subsetdf2016, use="pairwise.complete.obs"), method="color", tl.cex = .3)
```

Finally we plot correlation among all variables, considering also year as one of those.
**Year** only has a slight positive correlation with **solar** and **wind**, as already mentioned earlier, and a slight negative correlation with **coal**.

Some noticeable correlations between variables in different groups are the obvious ones renewables (hydro) and fossil sources, and their correlation to variables measuring pollution.

Similarly to the affirmation made earlier **coal** and **gas** **electricity** productions are correlated to their respective **reserves**, while **oil electricity** has a negative correlation to its **reserves**.

**Nuclear** is slightly positively correlated to **uranium reserves**, but it is equally correlated to economic indices (**GDP**, **HDI**)

\newpage

# Chapter 4
# Descriptive analyses

### 4.1 Global analyses

We start the descriptive analyses by looking at the global low-carbon electricity generation trends. By **low-carbon**, we refer to the electricity produced with substantially lower greenhouse gas emissions than conventional fossil fuel power generation [12]. In other words, the term low-carbon includes renewable and nuclear sources. We will now refer to it with the acronym **LC**.

```{r descriptive_1, fig.width=8, fig.height = 6,include=TRUE, warning = FALSE}

# 1. World electricity generation from LC sources

# a. Area plot of the total generation
# Creation of the dataset
place = main[c("year", "low_carbon_electricity")] %>%
  mutate_all(~replace_na(.,0)) %>%
  group_by(year) %>%
  summarize(sum_lc = sum(low_carbon_electricity))

# Creation of the plot
gg1 = ggplot(place, aes(year, sum_lc)) +
  geom_area(alpha = 0.7, colour="white") +
  scale_x_continuous(limits = c(1965,2020), breaks = seq(1965, 2020, by = 5)) +
  labs(title = "World electricity generation from LC sources",
       x = "Year",
       y = "Terawatt-hours")

# b. Area plot of the ratio between LC generation and total electricity generation
# Creation of the dataset
place = main[c("year", "low_carbon_electricity", "electricity_generation")] %>%
  mutate_all(~replace_na(.,0)) %>%
  group_by(year) %>%
  summarize(sum_lc = sum(low_carbon_electricity)/sum(electricity_generation))

# Creation of the plot
gg2 = ggplot(place, aes(year, sum_lc)) +
  geom_area(alpha = 0.7, colour="white") +
  scale_x_continuous(limits = c(1985,2020), breaks = seq(1985, 2020, by = 5)) +
  scale_y_continuous(limits = c(0,0.5)) +
  labs(title = "% of world electricity generated from LC sources",
       x = "Year",
       y = "% of terawatt-hours")

# Visualization of gg1 and gg2
grid.arrange(gg1,gg2)

```
World's electricity production from LC sources constantly grew, going from a generation of less than 1000 TwH in 1965 to more than 10000 TwH in 2020, with an impressive average yearly growth of 21.6%. 

Nonetheless, the second image clarifies an important point: even if the electricity generation from LC sources increased, the share of world electricity generated from LC sources has been stationary over the years, except for a timid increase from 2013 to 2020.

```{r descriptive_2, fig.width=8, fig.height = 4, include=TRUE , warning = FALSE}


# 2. World electricity generation from LC sources, grouped by countries

# a. Creation of a vector containing the ISO codes of the nine countries with the highest
# LC electricity production in 2020
place = main[c("year", "low_carbon_electricity")] %>% mutate_all(~replace_na(.,0))
place = cbind(iso_code = main$iso_code, place) %>%
  filter(year == 2020) %>%
  arrange(desc(low_carbon_electricity))
place_2 = place$iso_code[1:9]

# b. Group the other countries in a single class called "OTH" ("others")
place = main[c("year", "low_carbon_electricity")] %>% mutate_all(~replace_na(.,0))
place = cbind(iso_code = main$iso_code, place) 
for(i in 1:nrow(place)){
  place$iso_code[i] = ifelse(place$iso_code[i] %in% place_2, place$iso_code[i], "OTH")
}
place = group_by(place, iso_code, year) %>%
  summarize(sum_lc = sum(low_carbon_electricity))
place$iso_code = factor(place$iso_code,
                        levels = c("CHN", "USA", "BRA", "CAN", "FRA", "RUS",
                                   "IND", "DEU", "JPN", "OTH"))

#  c. Plot the graph
gg1 = ggplot(place, aes(year, sum_lc, fill = iso_code)) +
  geom_area(alpha=0.6, colour="white") +
  scale_x_continuous(limits = c(1965,2020), breaks = seq(1965, 2020, by = 5)) +
  labs(title = "World electricity generation from LC sources",
       subtitle = "Grouped by country",
       x = "Year",
       y = "Terawatt-hours") +
  scale_fill_viridis_d(name = "Source", option = "E")

# d. Share of electricity production by country in 2020
place = filter(place, year == 2020)
place$sum_lc = round(place$sum_lc / sum(place$sum_lc),2)
place = place[,c(1,3)] %>% arrange(desc(sum_lc)) %>% as.data.frame()
colnames(place) = c("ISO code","% LC generation")

# Plot gg1 and table
gg1
kable(cbind(place[1:5,], place[6:10,]),caption = "Share of LC electricity generation by country, 2020")

```
Not surprisingly, the generation of electricity from LC sources is not homogeneous between the countries: China and the USA own 41% of the electricity generated in 2020; the nine nations with the highest electricity generation from LC sources account for 69%.

### 4.2 Analyses by source

```{r descriptive_3, fig.width=8, fig.height = 10, include=TRUE, warning = FALSE}

# 3. World electricity generation from LC sources, grouped by source

# a. Area plot of the total electricity generation
# Creation of the dataset
place = main[c("year", "hydro_electricity",
                               "nuclear_electricity", "solar_electricity", "wind_electricity",
                               "other_renewable_electricity")] %>%
  mutate_all(~replace_na(.,0)) %>%
  group_by(year) %>%
  summarize(Nuclear = sum(nuclear_electricity),
            Hydro = sum(hydro_electricity),
            Wind = sum(wind_electricity),
            Solar = sum(solar_electricity),
            Other = sum(other_renewable_electricity)) %>%
  gather(key = "Type",
         value = "elect",
         -year)
place$Type = factor(place$Type, levels = c("Nuclear", "Hydro", "Solar", 
                                           "Wind", "Other"))

# Creation of the plot
gg1 = ggplot(place, aes(year, elect, fill = Type)) +
  geom_area(alpha=0.6 , size=.5, colour="white")+
  scale_x_continuous(limits = c(1965,2020), breaks = seq(1965, 2020, by = 5)) +
  scale_y_continuous(limits = c(0,10500)) +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
  labs(title = "World electricity generation from LC sources",
       subtitle = "Grouped by source",
       x = "Year",
       y = "Terawatt-hours")

# b. Area plot of the total electricity generation, with sum = 100
# Creation of the dataset
place = main[c("year","hydro_electricity", "wind_electricity", 
               "nuclear_electricity", "solar_electricity", 
               "other_renewable_electricity")] %>%
  mutate_all(~replace_na(.,0)) %>%
  group_by(year) %>%
  summarize(Nuclear = sum(nuclear_electricity),
            Hydro = sum(hydro_electricity),
            Wind = sum(wind_electricity),
            Solar = sum(solar_electricity),
            Other = sum(other_renewable_electricity)) %>%
  select(Nuclear, Hydro, Wind, Solar,
         Other, Nuclear) %>%
  mutate(year = 1900:2022, row_total = rowSums(.)) %>%
  mutate(across(Nuclear:Other, ~ . / row_total * 100)) %>%
  select(-row_total) %>%
  gather(key = "Type",
         value = "elect",
         -year)
place$Type = factor(place$Type, levels = c("Nuclear", "Hydro", "Solar", 
                                           "Wind", "Other"))

# Creation of the plot
gg2 = ggplot(place, aes(year, elect, fill = Type)) +
  geom_area(alpha=0.6 , size=.5, colour="white")+
  scale_x_continuous(limits = c(1965,2020), breaks = seq(1965, 2020, by = 5)) +
    scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
      labs(title = "World electricity generation from LC sources",
       subtitle = "Sum = 100, grouped by source",
       x = "Year",
       y = "% of terawatt-hours")

# c. Line plot of the difference of generation with respect to 5 years in the past
# Creation of the dataset
place = main[c("year", "hydro_electricity", "nuclear_electricity",
               "solar_electricity", "wind_electricity",
               "other_renewable_electricity")] %>%
  mutate_all(~replace_na(.,0)) %>%
  filter(year <= 2020) %>%
  group_by(year) %>%
  summarize(Nuclear = sum(nuclear_electricity),
            Hydro = sum(hydro_electricity),
            Wind = sum(wind_electricity),
            Solar = sum(solar_electricity),
            Other = sum(other_renewable_electricity)) %>%
  mutate(Nuclear = (Nuclear - dplyr::lag(Nuclear,5)),
         Hydro = (Hydro - dplyr::lag(Hydro,5)),
         Wind = (Wind - dplyr::lag(Wind,5)),
         Solar = (Solar - dplyr::lag(Solar,5)),
         Other = (Other - dplyr::lag(Other,5))) %>% 
  gather(key = "Type",
         value = "world_elect",
         -year)
place$Type = factor(place$Type, levels = c("Nuclear", "Hydro", "Solar", 
                                                "Wind", "Other"))

# Creation of the plot
gg3 = ggplot(place, aes(year, world_elect, colour = Type)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(1970,2020)) +
  scale_y_continuous() +
  scale_color_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
    labs(title = "World electricity generation from LC sources",
       subtitle = "Difference with respect to 5 years in the past, grouped by source",
       x = "Year",
       y = "Terawatt-hours")

# Visualization of gg1, gg2 and gg3
grid.arrange(gg1, gg2, gg3)


```
The plots allow us to identify three different phases in the history of LC electricity.

1. **Dawn of LC electricity** (up to the mid-'80s). In this era, there are two different trends: on one side, the electricity generated by hydropower grows linearly with respect to the past generation; on the other side, the civil usage of nuclear power takes the first steps.

2. **Golden age of nuclear electricity** (from the mid-'80s to mid-'00s). The electricity generation from nuclear reaches its peak, while the production of hydropower plants continues to grow linearly.

3. **Golden age of renewables** (from the mid-'00s to nowadays). Nuclear power generation declines and gives way to renewables. In particular, the solar and wind generation skyrockets.

### 4.3 Analyses by macroregion

We are now interested in analyzing electricity generation by LC sources in different areas. To do so, we aggregate world countries into six macroregions based on geographical, economic, and cultural factors.

1. **Developed countries**: Western Europe, Israel, USA, Canada, Australia, New Zealand, Japan, South Korea, Taiwan, Hong Kong, and Macao.

2. **Latin America and the Caribbean**: North and South America's countries, except for USA and Canada.

3. **Eastern Europe**: former members of the Warsaw Pact (excluding Kazakhstan, Turkmenistan, Uzbekistan, Tajikistan, and Kyrgyzstan) and former Yugoslavia.

4. **Middle East and Northern Africa**: Morocco, Algeria, Tunisia, Libya, Egypt, Jordan, Palestine, Lebanon, Syria, Turkey, Iraq, Iran, Kuwait, Saudi Arabia, Yemen, Oman, United Arab Emirates, Bahrain, and Qatar.

5. **Sub-Saharan Africa**: non-aforementioned African countries.

6. **Asia**: non-aforementioned Asian countries.

```{r descriptive_4, fig.width=8, fig.height = 6, include=TRUE, warning = FALSE}
# a. Creation of a vector for each macroregion, containing the ISO-codes
developed_countries = c("AUS", "AUT", "BEL", "CAN", "CYP", "DNK", "FRO", "FIN",
                        "FRA", "DEU", "GRC", "GRL", "HKG", "ISL", "IRL", "ISR",
                        "ITA", "JPN", "LUX", "MAC", "MLT", "NLD", "NZL", "NOR",
                        "PRT", "SPM", "KOR", "ESP", "SWE", "CHE", "TWN", "GBR",
                        "USA", "REU", "GIB")

latin_countries = c("ATG", "ARG", "ABW", "BHS", "BRB", "BLZ", "BMU", "BOL",
                    "BRA", "CYM", "CHL", "COL", "CRI", "CUB", "DMA", "DOM",
                    "ECU", "SLV", "FLK", "GUF", "GRD", "GLP", "GTM", "GUY",
                    "HTI", "HND", "JAM", "MTQ", "MEX", "MSR", "NIC", "PAN",
                    "PRY", "PER", "PRI", "KNA", "LCA", "VCT", "SUR", "TTO",
                    "TCA", "VIR", "URY", "VEN", "VGB", "ANT")

east_europe_countries = c("ALB", "ARM", "AZE", "BLR", "BIH", "BGR", "HRV",
                          "CZE", "EST", "GEO", "HUN", "LVA", "LTU", "MDA",
                          "MNE", "MKD", "POL", "ROU", "RUS", "SRB", "SVK",
                          "SVN", "UKR")

sub_african_countries = c("AGO", "BEN", "BWA", "BFA", "BDI", "CPV", "CMR",
                          "CAF", "TCD", "COM", "COG", "CIV", "COD", "DJI",
                          "GNQ", "ERI", "SWZ", "ETH", "GAB", "GMB", "GHA",
                          "GIN", "GNB", "KEN", "LSO", "LBR", "MDG", "MWI",
                          "MLI", "MRT", "MUS", "MOZ", "NAM", "NER", "NGA",
                          "RWA", "STP", "SEN", "SLE", "SOM", "ZAF", "SSD",
                          "SDN", "TZA", "TGO", "UGA", "ZMB", "ZWE", "SHN")

middle_east_countries = c("DZA", "BHR", "EGY", "IRN", "IRQ", "JOR", "KWT",
                          "LBN", "LBY", "MAR", "OMN", "PSE", "QAT", "SAU",
                          "SYR", "TUR", "ARE", "YEM", "TUN")

asian_countries = c("AFG", "ASM", "BGD", "BTN", "BRN", "KHM", "CHN", "COK",
                    "FJI", "PYF", "GUM", "IND", "IDN", "KAZ", "KIR", "KGZ",
                    "LAO", "MYS", "MDV", "FSM", "MNG", "MMR", "NRU", "NPL",
                    "NCL", "PRK", "MNP", "PAK", "PNG", "PHL", "WSM", "VNM",
                    "SYC", "SGP", "SLB", "LKA", "TJK", "THA", "TLS", "TON",
                    "TKM", "TUV", "UZB", "VUT", "NIU")

#b. Assign the grouping to each observation in "main"
tag = rep(0, nrow(main))

for(i in 1:length(tag)){
  if(main$iso_code[i] %in% developed_countries){
    tag[i] = "developed"
  }
  else{
    if(main$iso_code[i] %in% latin_countries){
      tag[i] = "latin"
    }
    else{
      if(main$iso_code[i] %in% east_europe_countries){
        tag[i] = "east_europe"
      }
      else{
        if(main$iso_code[i] %in% sub_african_countries){
          tag[i] = "sub_african"
        }
        else{
          if(main$iso_code[i] %in% middle_east_countries){
            tag[i] = "middle_east"
          }
          else{
            if(main$iso_code[i] %in% asian_countries){
              tag[i] = "asian"
            }
          }
        }
      }
    }
  }
}
main = cbind(main, tag)

# c.Plot of the world map
df_asian = data.frame(region = "Asia", tag = asian_countries)
df_east = data.frame(region = "Eastern Europe", tag = east_europe_countries)
df_middle = data.frame(region = "Mid. East & N. Africa", tag = middle_east_countries)
df_dev = data.frame(region = "Developed", tag = developed_countries)
df_africa = data.frame(region ="Sub-Sah. Africa", tag = sub_african_countries)
df_latin = data.frame(region = "Latin A. & Carr.", tag = latin_countries)
df_world = rbind(df_asian, df_east, df_middle, df_dev, df_africa, df_latin)


map = joinCountryData2Map(df_world, joinCode = "ISO3",
                          nameJoinColumn = "tag")
mapCountryData(map, nameColumnToPlot = "region", catMethod = "categorical",
               missingCountryCol = gray(.8),
               colourPalette = c("#35B779", "#FDE725", "#21908C", "#440154",
                                 "#8FD744", "#30678D"),
               mapTitle = "World grouping in macroregions")
```

```{r descriptive_5, fig.width=8, fig.height = 8, include=TRUE, warning = FALSE}

# 3. World electricity generation from LC sources, grouped by macroregion

# a. LC generation by macroregion
# Creation of the dataset
place = main[c("year","hydro_electricity", "wind_electricity", 
               "nuclear_electricity", "solar_electricity", 
               "other_renewable_electricity", "electricity_generation")] %>%
  mutate_all(~replace_na(.,0)) %>%
  cbind(., tag = main$tag) %>%
  group_by(year, tag) %>%
  summarize(Nuclear = sum(nuclear_electricity)/sum(electricity_generation),
            Hydro = sum(hydro_electricity)/sum(electricity_generation),
            Wind = sum(wind_electricity)/sum(electricity_generation),
            Solar = sum(solar_electricity)/sum(electricity_generation),
            Other = sum(other_renewable_electricity)/sum(electricity_generation)) %>%
  gather(key = "Type",
         value = "elect",
         -year, -tag)
place$Type = factor(place$Type, levels = c("Nuclear", "Hydro", "Solar", 
                                           "Wind", "Other"))
# Here we remove data for Sub-Saharan countries from 2000, as data is not available
# for most of the countries
for(i in 1:nrow(place)){
  if(place$year[i] < 2000 & place$tag[i] == "sub_african"){
    place$elect[i] = 0
  }
}

tag_modifier = function(place_data){
  place_data[place_data$tag  == "asian", "tag"] = "Asian"
  place_data[place_data$tag  == "developed", "tag"] = "Developed"
  place_data[place_data$tag  == "east_europe", "tag"] = "Eastern Europe"
  place_data[place_data$tag  == "latin", "tag"] = "Latin America & Caribbeans"
  place_data[place_data$tag  == "middle_east", "tag"] = "Middle East & Northern Africa"
  place_data[place_data$tag  == "sub_african", "tag"] = "Sub-Saharan Africa"
  return(place_data)
}

source_modifier = function(place_data){
  place_data[place_data$Source  == "nuclear_share_elec", "Source"] = "Nuclear"
  place_data[place_data$Source  == "hydro_share_elec", "Source"] = "Hydro"
  place_data[place_data$Source  == "solar_share_elec", "Source"] = "Solar"
  place_data[place_data$Source  == "wind_share_elec", "Source"] = "Wind"
  place_data[place_data$Source  == "other_renewables_share_elec", "Source"] = "Other"

  place_data$Source = factor(place_data$Source, levels = c("Nuclear", "Hydro", "Solar", "Wind",
                                               "Other"))
  return(place_data)
}

place = tag_modifier(place)


# Creation of the plot
gg1 = ggplot(place, aes(year, elect, fill = Type)) +
  geom_area(alpha=0.6 , size=.5, colour="white")+
  scale_x_continuous(limits = c(1985,2020)) +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
  facet_wrap(~ tag, nrow = 2) +
  labs(title = "Share of electricity generation from LC sources",
       subtitle = "Grouped by source and macroregion",
       x = "Year",
       y = "% of terawatt-hours")

# b. Plot of renewables generation by macroregion, excluding hydropower
# Creation of the dataset
place = filter(place, Type == "Solar" | Type == "Wind" | Type == "Other")

# Creation of the plot
gg2 = ggplot(place, aes(year, elect, fill = Type)) +
  geom_area(alpha=0.6 , size=.5, colour="white")+
  scale_x_continuous(limits = c(1985,2020)) +
  scale_fill_manual(values = c("#0060FA", "#141BDB", "#00296B")) +
  facet_wrap(~ tag, nrow = 2) +
  labs(x = "Year",
       y = "% of terawatt-hours")

# Visualization of gg1, gg2 and gg3
grid.arrange(gg1, gg2, ncol=1)

```

A variety of conclusions can be drawn from the previous graphs. Here we present the four main findings.

1. The different areas are **not homogeneous** in electricity generation from low-carbon sources: Latin American countries have a more significant share; developed, Eastern European and Sub-Saharan and Asian follow; Middle-East generation is negligible.

2. **Hydropower** is an essential source of electricity in all the considered macroregions.

3. **Nuclear electricity** is significant only in developed countries and Eastern Europe; its importance is comparable to hydropower generation in those macroregions.

4. Developed countries drive **non-hydropower renewable** production. Nonetheless, it is also true that those sources are also rapidly becoming more relevant in Latin America and Asia.

It is important to highlight also that a lower total electricity generation heavily influences Asian, Latin American, and (especially) Sub-Saharan generation rates, as the graph below shows.


```{r descriptive_7, fig.width=8, fig.height = 4,include=TRUE, warning = FALSE}
# Focus on electricity generation per capita
# Creation of the dataset
place = main[c("year","electricity_generation", "population")] %>%
  mutate_all(~replace_na(.,0)) %>%
  cbind(., tag = main$tag) %>%
  group_by(tag,year) %>%
  summarize(gen_per_capita = sum(electricity_generation)/sum(population))

place = tag_modifier(place)
place$tag = factor(place$tag, levels = c("Developed", "Eastern Europe",
                                         "Middle East & Northern Africa",
                                         "Asian", "Latin America & Caribbeans",
                                         "Sub-Saharan Africa"))
colnames(place) = c("Macroregion","year","gen_per_capita")


# Creation of the plot
ggplot(place, aes(year, gen_per_capita, color = Macroregion)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(limits = c(1985,2020), breaks = seq(1985, 2020, by = 5)) +
  scale_color_manual(values = c("#EA5555", "#F39C3C", "#ECD03F", "#6EB35E", "#4996C8",
                                "#774ED8")) +
  labs(title = "Electricity generation per capita",
       subtitle = "Grouped by macroregion",
       x = "Year",
       y = "Per capita terawatt-hours")
  

```

The electricity generation from non-hydro renewable sources in Sub-Saharan Africa increases rapidly between 2011 and 2015. Therefore, we studied the behavior of the five countries in the region with the highest non-hydro renewable electricity generation in 2015. As the plot shows, the steep increase is simply due to an exploding generation from solar and wind sources in South Africa.

```{r descriptive_8, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
suppressMessages({
# Extract the LC production grouped by source from 2011 to 2015 of the five countries
# with the highest renewables production in 2015

#a. Extract the ISO of five countries with the highest non-hydro renewables generation
#   in 2015
place = select(main, iso_code, year, renewables_electricity, hydro_electricity) %>%
  filter(year == 2015 & tag == "sub_african") %>%
  mutate(non_hydro_elec = renewables_electricity - hydro_electricity) %>%
  arrange(desc(non_hydro_elec)) %>%
  select(iso_code) %>%
  top_n(5) %>%
  as.data.frame()

# b. Creation of the dataset
place = select(main, year, iso_code, renewables_electricity, hydro_electricity) %>%
  filter(year <= 2015 & year >= 2011 & iso_code %in% place$iso_code) %>%
  mutate(non_hydro_elec = renewables_electricity - hydro_electricity)
colnames(place) = c(colnames(place)[1], "ISO_code", colnames(place)[3:5])

# c. Creation the plot
ggplot(place, aes(year, non_hydro_elec, color = ISO_code)) +
  geom_line(size = 1) +
  geom_point(size = 1.5) +
  scale_x_continuous(limits = c(2011,2015), breaks = place$year) +
  scale_color_manual(values = c("#EA5555", "#F39C3C", "#ECD03F", "#6EB35E", "#4996C8")) +
    labs(title = "Share of electricity from non-hydro renewables",
       subtitle = "Selection of Sub-Saharan African countries",
       x = "Year",
       y = "% of terawatt-hours")
})

  


```

### 4.4 Green Score with focus on the sources

In this section, we aim to study which countries are nearer to the full LC target (i.e., to produce from LC sources all the electricity they consume). To do so, we create a **Green Score**, defined as the following ratio:
\[
\text{GS} = \frac{\text{electricity generated from LC sources}}{{\text{electricity demand}}}
\]
Note that in paragraphs 4.4 and 4.5 analyses, we removed the countries with a smaller population than 500,000. The reason is that we expect those countries to be too small to have a significant independent electricity policy with respect to their neighbors.
```{r descriptive_9, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
# Note. x is computed as the squared root of the electricity demand per capita, scaled in
# the interval [0,1]. We plot the electricity demand per capita to distinguish if the
# high Green Score is due to low electricity consumption or good green policies. We
# choose the described scaling because it allows for spacing more points in the graph.

# Scatterplot of the Green Score in 2020 in each country
# Creation of the dataset
place = filter(main, (year == 2020 & population > 500000 & iso_code != "REU")) %>%
  transform(elec_demand_per_capita = (sqrt(electricity_demand / population) - min(sqrt(electricity_demand / population))) / (max(sqrt(electricity_demand / population)) - min(sqrt(electricity_demand / population))),
         green_score_renew = renewables_electricity / electricity_demand,
         green_score_lc = low_carbon_electricity / electricity_demand) %>%
  select(iso_code, elec_demand_per_capita, green_score_renew, green_score_lc)

# Creation of the plot
ggplot()+
  geom_point(data = filter(place, iso_code != "LAO", iso_code != "BTN",
                           iso_code != "PRY", iso_code != "NOR"),
             mapping = aes(elec_demand_per_capita, green_score_lc,
                           color = green_score_lc)) +
  geom_text(data = filter(place, iso_code == "LAO" | iso_code == "BTN" |
                            iso_code == "PRY" | iso_code == "NOR"),
            mapping = aes(elec_demand_per_capita, green_score_lc,
                          label = iso_code, color = green_score_lc)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  scale_color_gradient(low = "#ECD03F", high = "#59E80C", na.value = "#59E80C",
                       limits = c(0,1), guide = "none") +
  labs(title = "Green Score of world countries, 2020",
       x = "Scaled electricity demand per capita",
       y = "Green Score")
```
The plot highlights **four main outliers**: Laos, Bhutan, and Paraguay, with an overscaled Green Score and a low electricity demand per capita; Norway, with a positive Green Score while being the country with the highest electricity demand per capita. We want to understand if they have shared features that allow us to explain their outperformance.

```{r descriptive_10, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}

# Barplot of the electricity generation mix in LAO, BTN, PRY and NOR
# Creation of the dataset
place = filter(main, (year == 2020 & (iso_code == "LAO" | iso_code == "BTN" |
                                        iso_code == "PRY" | iso_code == "NOR"))) %>%
  select(iso_code, solar_share_elec, wind_share_elec, hydro_share_elec,
         nuclear_share_elec, other_renewables_share_elec) %>%
  gather(key = "Source", value = "value", -iso_code)

# The following function modify the names of the sources to enchance the visualization
source_modifier = function(place_data){
  place_data[place_data$Source  == "nuclear_share_elec", "Source"] = "Nuclear"
  place_data[place_data$Source  == "hydro_share_elec", "Source"] = "Hydro"
  place_data[place_data$Source  == "solar_share_elec", "Source"] = "Solar"
  place_data[place_data$Source  == "wind_share_elec", "Source"] = "Wind"
  place_data[place_data$Source  == "other_renewables_share_elec", "Source"] = "Other"

  place_data$Source = factor(place_data$Source, levels = c("Nuclear", "Hydro", "Solar", "Wind",
                                               "Other"))
  return(place_data)
}

place = source_modifier(place)


# Creation of the plot
ggplot(place, aes(x = iso_code, y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
  labs(title = "Electricity generation mix in selected countries, 2020",
       x = "",
       y = "% gen. from LC sources")


```
The high performance of the countries is due to a **dominant hydroelectric generation**. For example, further research on the topic highlights that Laos aims to become the "Battery of Southeast Asia" by further exploiting its impressive hydropower potential [13]. So those countries can achieve such an impressive result because of a resource not available everywhere.

Nonetheless, some countries have great hydropower generation but do not exploit it: for instance, the Democratic Republic of Congo has a potential of 100.000 MW (more than four times the biggest hydropower plant in the world, the Three Gorges Dam [14]), but uses only 2.5% of it due to political instability and lack of investments [15].

We then analyze further the correlation between each LC source and the Green Score.
```{r descriptive_11, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}

# Scatterplot of the green Score VS share of electricity produced from each LC source
# Creation of the dataset
place = filter(main, year == 2020) %>%
  transform(green_score_lc = (low_carbon_electricity / electricity_demand)) %>%
  select(iso_code, green_score_lc, nuclear_share_elec, hydro_share_elec,
         solar_share_elec, wind_share_elec, other_renewables_share_elec,
         green_score_lc) %>%
  filter(complete.cases(.)) %>%
  gather(key = "Source", value = "value", -iso_code, -green_score_lc) %>%
  # We excluded countries with an irrelevant production from each source
  filter(value > 1)

place = source_modifier(place)

# Creation of the plot
ggplot(filter(place, iso_code != "LAO", iso_code != "BTN", iso_code != "PRY"),
       aes(value, green_score_lc, color = value)) +
  geom_point() +
  geom_smooth(method = "loess", span = 2, se = FALSE, size = 1) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  scale_color_gradient(low = "grey30", high = "#59E80C", na.value = "#59E80C",
                       limits = c(0,40),
                       guide = "none") +
  facet_wrap(~Source, nrow = 2) +
  labs(title = "Green Score VS share of LC generation by source, 2020",
       x = "% gen. from LC source",
       y = "Green Score")

# Note. "loess" is a statistical technique used for estimating smooth curves in
# scatterplot data. It works by fitting multiple local regression models
# to different subsets of the data, allowing it to capture non-linear patterns and
# relationships between variables. It was introduced in the following plot only to
# highlight better the trends from a graphical point of view.

```
The plot confirms the correlation between the Green Score and the electricity generation from hydropower. It also shows an important link with nuclear power production but not with solar, wind, and other sources.

### 4.5 Green Score with focus on the macroregions

In this final section of descriptive analyses, we focus on the analysis of the Green Score in each country.

```{r descriptive_12, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
# Boxplot of the Green Score
# Creation of the dataset
place = filter(main, year == 2020) %>%
  transform(green_score_lc = (low_carbon_electricity / electricity_demand)) %>%
  select(iso_code, tag, green_score_lc)

place[place$tag  == "asian", "tag"] = "Asian"
place[place$tag  == "developed", "tag"] = "Developed"
place[place$tag  == "east_europe", "tag"] = "East. Europe"
place[place$tag  == "latin", "tag"] = "L. Am. & C."
place[place$tag  == "middle_east", "tag"] = "M. East & N. Africa"
place[place$tag  == "sub_african", "tag"] = "S.S. Africa"

colnames(place) = c("iso_code", "Macroregion", "green_score_lc")

# Creation of the plot
ggplot(place, aes(x = Macroregion, y = green_score_lc)) +
  geom_boxplot(aes(fill = Macroregion)) +
  ylim(0,1.25) +
  scale_fill_manual(values = c("#EA5555", "#F39C3C", "#ECD03F", "#6EB35E", "#4996C8",
                                "#774ED8")) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
    labs(title = "Boxplots of the Green Score, 2020",
         subtitle = "Grouped by macroregion",
       x = "",
       y = "Green Score")

```

The leading macroregion by Green Score comprises the **developed countries**, followed by Eastern Europe, Sub-Saharian Africa, Asia, and Latin America & Caribbeans. The Middle East & Northern Africa has significantly lower score compared to other areas. Let us now explore each area separately.

```{r descriptive_13, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
# Barplot of the Green Score 
# Creation of the dataset
place = filter(main, year == 2020, !is.na(other_renewables_share_elec),
               population >= 500000) %>%
  transform(ratio = (low_carbon_electricity / (electricity_demand * low_carbon_share_elec))) %>%
  transform(solar_share_elec = ratio * solar_share_elec,
            wind_share_elec = ratio * wind_share_elec,
            hydro_share_elec = ratio * hydro_share_elec,
            nuclear_share_elec = ratio * nuclear_share_elec,
            other_renewables_share_elec = ratio * other_renewables_share_elec) %>%
  select(iso_code, tag, solar_share_elec, wind_share_elec,
         hydro_share_elec, nuclear_share_elec, other_renewables_share_elec) %>%
  # There are NaN values obtain because of division by zero. We want them to be 0
  mutate(across(where(is.numeric), ~ ifelse(is.nan(.), 0, .))) %>%
  # There are NA values. We want to remove them
  gather(key = "Source", value = "value", -iso_code, -tag)

place = source_modifier(place)

# Creation of the plot for the developed countries
ggplot(filter(place, tag == "developed"),
       aes(x = reorder(iso_code, value), y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
  scale_y_continuous(breaks = seq(0, 1.2, by = 0.2)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  labs(title = "Green Score in developed countries, 2020",
       subtitle = "Grouped by source",
       x = "",
       y = "Green Score") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))




```
The developed countries with the highest Green Scores are **Sweden**, Norway, Switzerland, and France. In contrast, the ones with the lowest values are Macao, Hong Kong, Israel, and Malta.

The LC sources are heterogeneous: while countries like Norway, Switzerland, and Canada are mainly driven by hydropower, others like France and Belgium mainly generate electricity from nuclear power, and others still, like Denmark and Ireland, are mainly driven by non-hydro renewables.

It is also interesting to highlight that the developed Asian countries tend to have a lower score than the others: Japan is the second-best-performing Asian country, but it outperforms only Australia, Luxembourg, Cyprus, and Malta.

```{r descriptive_14, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
# Creation of the plot for Eastern Europe
ggplot(filter(place, tag == "east_europe"),
       aes(x = reorder(iso_code, value), y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.2)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  labs(title = "Green Score in Eastern Europe, 2020",
       subtitle = "Grouped by source",
       x = "",
       y = "Green Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
No country in Eastern Europe is near a Green Score equal to 1: the best-performing one is **Slovenia**, with a score of 0.72. Follow Slovakia, Albania, and Armenia. There are also three countries with a score near zero in the region: Belarus, Azerbaijan, and Moldova. As the barplot shows, Eastern European countries mainly produce LC electricity through hydro and nuclear sources.

```{r descriptive_15, fig.width=8, fig.height = 12, include=TRUE, warning = FALSE}
# Creation of the plot for Latin America & Caribbean
gg1 = ggplot(filter(place, tag == "latin", iso_code != "PRY"),
       aes(x = reorder(iso_code, value), y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
    scale_y_continuous(breaks = seq(0, 1.2, by = 0.2)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  labs(title = "Green Score in L. America & Caribbean, Asia, and Sub-Saharan countries, 2020",
       subtitle = "Grouped by source. Note: Paraguay, Laos and Bhutan removed being outliers",
       x = "",
       y = "Green Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Creation of the plot for the Asian countries
gg2 = ggplot(filter(place, tag == "asian", iso_code != "LAO", iso_code != "BTN"),
       aes(x = reorder(iso_code, value), y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.2)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  labs(x = "",
       y = "Green Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# creation of the plot for the Sub-Saharan Africa
gg3 = ggplot(filter(place, tag == "sub_african"),
       aes(x = reorder(iso_code, value), y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
    scale_y_continuous(breaks = seq(0, 1.2, by = 0.2)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  labs(x = "",
       y = "Green Score") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Visualization of the plots
grid.arrange(gg1, gg2, gg3, ncol=1)

```
We grouped the findings for Latin America & Caribbean, Asia, and Sub-Saharan countries because their electricity mixes are similar and mainly driven by hydropower.

The **best-performing** countries in each macroregion are Costa Rica, Uruguay, and Ecuador for Latin America & Caribbean; Tajikistan, Kyrgyzstan, and North Korea for Asia; Ethiopia, Mozambique, and Uganda for Sub-Saharan Africa. Instead, the countries with the lowest Green Score are respectively: Haiti, Porto Rico, and Trinidad & Tobago; Timor Est, Turkmenistan, and Solomon Islands; Botswana, Guinea-Bissau, Gambia, Djibouti, and Comoros (tied with totally fossil-dependent electricity generation).

Here are the other main observations:

1. some Latin American and Caribbean countries also have significant production from other sources, notably **Uruguay**, which mainly produces electricity through wind power;

2. **Kenya** is the only Sub-Saharan country with a good Green Score that generates significantly from non-hydropower sources. The reason is that the country exploits the incredibly cost-effective geothermic capacity of the Rift Valley. [16]

```{r descriptive_16, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
# Creation of the plot for the North African & Middle-East countries
ggplot(filter(place, tag == "middle_east"),
       aes(x = reorder(iso_code, value), y = value, fill = Source)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.6, colour = "white") +
  scale_fill_manual(values = c("#B2FF00", "#05B6FF", "#0060FA", "#141BDB", "#00296B")) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.2)) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "red") +
  labs(title = "Green Score in Middle East & North Africa 2020",
       subtitle = "Grouped by source",
       x = "",
       y = "Green Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
We conclude the descriptive analyses by examining the performance of Northern African and Middle East countries. Consistently with the findings in paragraph 4.3, the barplot shows that all the countries fail to reach a good performance: the best performing one, **Turkey**, has a Green Score smaller than 0.5. As the following table shows, this is mainly due to their large availability of oil and gas.

```{r descriptive_17, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
# Creation of a dataset containing per capita average fossil reserves in Middle-East
# and Northern African countries VS the rest of the world
place = filter(main, year == 2020, tag == "middle_east") %>%
  select(population, oil_reserves_2020, gas_reserves) %>%
  mutate_all(~replace_na(.,0)) %>%
  summarize(oil_reserves_2020 = round(mean(oil_reserves_2020 / population),2),
            gas_reserves = round(mean(gas_reserves / population),2))

place2 = filter(main, year == 2020, tag != "middle_east") %>%
  select(population, oil_reserves_2020, gas_reserves) %>%
  mutate_all(~replace_na(.,0)) %>%
  summarize(oil_reserves_2020 = round(mean(oil_reserves_2020 / population),2),
            gas_reserves = round(mean(gas_reserves / population),2))

place = rbind(place, place2)
place = cbind(c("Middle East & North Africa", "Other countries"), place)
colnames(place) = c("Macroregion", "Oil (2020)", "Gas (2020)")
kable(place, caption = "Per capita reserves of fossil electricity sources")

```
\newpage

# Chapter 5
# Modeling
### 5.1 Initial data preparation for Modeling
To build the models we start from preparing the data for it.

We start by taking the dataset as transformed in the exploratory analysis (pro capite in million inhabitants and logarithm transformations), to this dataset we will add a column containing the **tag** variable, as done in the descriptive analysis, and also add dummy variables for it; we add both the variable and it's dummies because linear models and stepwise selection work with it (and for stepwise variable selection this way it either keeps all the modes of the variables or discards all), while instead for lasso and ridge models we need the variable as a dummy.

We get a subset of the dataset containing only units that year variables between 2000 and 2019 (even if this passage might be redundant with the next), and then we get a subset that contains only complete cases of the dataset.

```{r model_1, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
#adding tags here as well
mainlog = cbind(mainlog, tag)
mainlog = cbind(mainlog, model.matrix(~-1+tag, data=mainlog))
#keep only years between 2000 and 2019
mainlogm = mainlog[mainlog$year %in% 2000:2019,]

mainlogm=mainlogm[complete.cases(mainlogm),]
```

### 5.2 Functions definition
In order to make multiple models we approached the task by having the models being built using calls to functions, to make the code less repetitive.

We define the first two functions, one that applies min-max normalization, and another that applies the logit function (slightly modified to avoid infinites, since our data goes from 0 to 1, including the extremes), and we define what columns we will later apply the functions to (in this case all numerical columns except **year**).

```{r model_2, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
#normalizing columns
normalize <- function(x) {
  return((x- min(x)) /(max(x)-min(x)))
}

#applying logit to normalized column
logify <- function(x){
  return(qlogis((x/1.00001)+0.000005))
}

normcols=c(4:46)
```

In the next passage we define a the function selectvar_nl, it gets passed five arguments:

- Bi, boolean value, identifies whether we want to include as independent variables in the model variables that are belong to the **Energy dataset** and regard specific energy sources;
- Bt, boolean value, identifies whether we want to include the **tag** as independent variable in the model;
- By, boolean value, identifies whether the functions defined above to normalize and apply the logit function over the column grouped by year, or on the whole column;
- Bl, boolean value, identifies whether to apply the logit function or not (normalize is always applied);
- mlm, the dataset to be transformed.

The function returns a list with two items: the first is the modified dataset, the second contains a list with the names of the variables that will be used and independent variables in the model.

```{r model_4, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
selectvar_nl <- function(Bi=Bindepsource, Bt=Btag, By=Byearwise, Bl=Blogify, mlm=mainlogm){
  if (By){
    #year-wise normalization
    for (i in unique(mlm$year)){
      mlm[mlm$year==i,normcols] <- lapply(mlm[mlm$year==i,normcols], normalize)
    }
  } else {
    #overall normalization
    mlm[normcols] <- lapply(mlm[normcols], normalize)
  }
  #normalize year
  mlm["year"] <- lapply(mlm["year"], normalize)
  
  if (Bl){
    if(By){
      #year-wise logify
      for (i in unique(mlm$year)){
        mlm[mlm$year==i,normcols] <- lapply(mlm[mlm$year==i,normcols], logify)
      }
    } else {
      #overall logify
      mlm[normcols] <- lapply(mlm[normcols], logify)
    }
    #logify year
    mlm["year"] <- lapply(mlm["year"], logify)
  }
  
  if (Bi){
    independent = colnames(mlm)[c(2,4,6,14,18,23,25,28,33,35,37,38,39,41,42,43,44,45,46)]
  } else {
    independent = colnames(mlm)[c(2,4,37,38,39,41,42,43,44,45,46)]
  }
  if (Bt){
    independent = append(independent, colnames(mlm[47]))
  }
  return(list("mlm"=mlm, "ind"=independent))
}
```

Next we define the function setup_lr, it has four arguments:

- mlm, the dataset used for the model;
- dep, the name of the dependent variable in the model;
- ind, the list containing the names of the independent variables in the model;
- Bt, boolean, whether the model should have **tag** as independent variable.

The function returns a list of two elements, the first is the list of values for the dependent variable, the second is a matrix that contains the values of the variables used as independent variables (the transformation to matrix is needed to use the function that create lasso and ridge models).

```{r model_5, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
#Setup for Lasso and Ridge
setup_lr = function(mlm=model_data, dep=dependent, ind=independent, Bt=Btag){
  y = mlm[,dep]
  if (Bt){
    x = data.matrix(select(mlm,c(head(ind,-1),tail(colnames(mlm),6))))
  } else {
    x = data.matrix(select(mlm,ind))
  }
  return(list("y"=y, "x"=x))
}

```

Then we define the function rs_models, which gets as arguments as setup_lr.

The function runs the linear model with the dependent and independent variables passed in the arguments, then performs a stepwise variables selection using, using BIC as criterion (k=log(n)).

Subsequently it calls the function setup_lr to get the matrixes to run glmnet; it uses cross-validation to find the best lambda and then uses it to build the elastic-net models (lasso with alpha = 1, ridge with alpha=0).

Finally the function returns a list of 5 values:

- rs, a list that has the R squared for each of the models;
- coeff_lm, list that contains the coefficients in the linear model;
- coeff_sm, list that contains the coefficients in the linear model after stepwise variable selection;
- coeff_lasso, list that contains the coefficients in the lasso model;
- coeff_ridge, list that contains the coefficients in the ridge model.

All the coefficients' variables are ordered by their descending absolute value

```{r model_6, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
rs_models = function(mlm=model_data, dep=dependent, ind=independent, Bt=Btag){
  my_formula <- as.formula(paste(paste(dep), " ~ ", paste(ind, collapse = " + ")))
  model <- lm(my_formula, mlm)
  step_model=step(model,direction=c("both"), trace=FALSE, k=log(nrow(mainlogm)))
  xy = setup_lr(mlm, dep, ind, Bt)
  x = xy$x
  y = xy$y
  cv_model = cv.glmnet(x, y, alpha = 1)
  best_lasso = glmnet(x, y, alpha = 1, lambda = cv_model$lambda.min)
  cv_model = cv.glmnet(x, y, alpha = 0)
  best_ridge = glmnet(x, y, alpha = 0, lambda = cv_model$lambda.min)
  names_coeff_lasso = dimnames(coef(best_lasso))[[1]][which(coef(best_lasso) != 0)]
  names_coeff_ridge = dimnames(coef(best_ridge))[[1]][which(coef(best_ridge) != 0)]
  values_coeff_lasso = coef(best_lasso)[which(coef(best_lasso) != 0)]
  values_coeff_ridge = coef(best_ridge)[which(coef(best_ridge) != 0)]
  coeff_lasso = setNames(values_coeff_lasso, names_coeff_lasso)
  coeff_ridge = setNames(values_coeff_ridge, names_coeff_ridge)
  coeff_lm = model$coefficients
  coeff_sm = step_model$coefficients
  rsq = c(summary(model)$r.squared, summary(step_model)$r.squared, best_lasso$dev.ratio, best_ridge$dev.ratio)
  return(list("rs" = setNames(rsq, c("lm","sm","lasso","ridge")),
              "coeff_lm" = coeff_lm[order(-abs(sapply(coeff_lm,'[[',1)))],
              "coeff_sm" = coeff_sm[order(-abs(sapply(coeff_sm,'[[',1)))],
              "coeff_lasso" = coeff_lasso[order(-abs(sapply(coeff_lasso,'[[',1)))],
              "coeff_ridge" = coeff_ridge[order(-abs(sapply(coeff_ridge,'[[',1)))]))
}
```

The last function defined is do_models.

It only has one argument, depen, which is the name of the dependent variable we want to have in the model.

The function build a dataframe with 8 columns, the first four are for the four boolean values used as arguments by selectvar_nl, the last four are the values returned by rs_models in the rs item (the R squared value for the four models).

For each combination of True-False value possible with the four arguments of selectvar_nl the function calls select var and then calls rs_models giving as arguments the data and list of independent variables returned by selectvar_nl; the value are then inserted in the dataframe.

The function then returns which arguments are to be passed to get the best models (to be precise the model with the best R squared for the linear with stepwise selection) and its scores, together with the coefficients of the stepwise selection model with such arguments.

Then the same is returned again, but this time only considering the models that don't contain the energy source data as independent variables.

Finally the whole dataframe is returned.

This approach allows to compare the performance of all different models, to learn how to build the best model for the data.

```{r model_7, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models <- function(depen = dependent){
  dependent = depen
  
  results_df <- data.frame(Bindepsource = logical(), Btag = logical(),
                           Byearwise = logical(), Blogify = logical(),
                           lm = numeric(), sm = numeric(),
                           lasso = numeric(), ridge = numeric())
  
  for (i in c(TRUE, FALSE)) {
    for (j in c(TRUE, FALSE)) {
      for (k in c(TRUE, FALSE)) {
        for (l in c(TRUE, FALSE)) {
          tmp = selectvar_nl(Bi=i, Bt=j, By=k, Bl=l)
          model_data = tmp$mlm
          independent = tmp$ind
          results = rs_models(mlm=model_data, dep=dependent, ind=independent, Bt=j)
          results_df <- rbind(results_df, data.frame(Bindepsource = i,
                                                     Btag = j,
                                                     Byearwise = k,
                                                     Blogify = l,
                                                     lm = results$rs['lm'],
                                                     sm = results$rs['sm'],
                                                     lasso = results$rs['lasso'],
                                                     ridge = results$rs['ridge']))
        }
      }
    }
  }
  
  max_row <- results_df[which.max(results_df$sm), ]
  
  max_row_nind <- results_df[which.max(results_df[9:16,]$sm)+8, ]
  
  tmp = selectvar_nl(Bi=max_row$Bindepsource, Bt=max_row$Btag,
                     By=max_row$Byearwise, Bl=max_row$Blogify)
  model_data = tmp$mlm
  independent = tmp$ind
  results = rs_models(mlm=model_data, dep=dependent,
                      ind=independent, Bt=max_row$Btag)
  
  tmp = selectvar_nl(Bi=max_row_nind$Bindepsource, Bt=max_row_nind$Btag,
                     By=max_row_nind$Byearwise, Bl=max_row_nind$Blogify)
  model_data = tmp$mlm
  independent = tmp$ind
  results_nind = rs_models(mlm=model_data, dep=dependent,
                           ind=independent, Bt=max_row_nind$Btag)
  
  print(paste("Model for the variable:", dependent))
  print("Best performing models:")
  print(max_row)
  print("Coefficients for best stepwise lm:")
  print(results$coeff_sm)
  print("Best performing models with only external data:")
  print(max_row_nind)
  print("Coefficients for best stepwise lm with only external data:")
  print(results_nind$coeff_sm)
  print("Performance on all models:")
  print(results_df)
   
}
```

### 5.3 Obtaining Models
The last step involves only calling the **do_models** function, passing it as argument the dependent variable for the model.

The dependent variables that will be passed are 10, all are variables included in the initial **Energy dataset**, the first two are **carbon intensity of electricity** and **greenhouse gas emissions**, the other 8 are the share of electricity of fossil electricity and all the single low carbon electricity sources (and grouping as renewables and low carbon).

#### 5.3.1 Carbon intensity of electricity
```{r model_8, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="carbon_intensity_elec")
```


#### 5.3.2 Greenhouse gas emissions
```{r model_9, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="greenhouse_gas_emissions")
```


#### 5.3.3 Fossil share of electricity
```{r model_10, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="fossil_share_elec")
```


#### 5.3.4 Hydro share of electricity
```{r model_11, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="hydro_share_elec")
```


#### 5.3.5 Solar share of electricity
```{r model_12, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="solar_share_elec")
```


#### 5.3.6 Wind share of electricity
```{r model_13, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="wind_share_elec")
```


#### 5.3.7 Other renewables share of electricity
```{r model_14, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="other_renewables_share_elec")
```


#### 5.3.8 Renewables share of electricity
```{r model_15, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="renewables_share_elec")
```


#### 5.3.9 Nuclear share of electricity
```{r model_16, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="nuclear_share_elec")
```


#### 5.3.10 Low carbon share of electricity
```{r model_17, fig.width=8, fig.height = 4, include=TRUE, warning = FALSE}
do_models(depen="low_carbon_share_elec")
```


\newpage
# Sitography
[1] https://github.com/owid/energy-data

[2] https://data.worldbank.org/indicator/NY.GDP.MKTP.KD

[3] https://ourworldindata.org/grapher/land-area-km 

[4] https://ourworldindata.org/grapher/share-of-land-area-used-for-agriculture

[5] https://ourworldindata.org/grapher/share-of-population-urban

[6] https://ourworldindata.org/grapher/human-development-index

[7] https://ourworldindata.org/grapher/death-rates-from-air-pollution

[8] https://ourworldindata.org/grapher/coal-proved-reserves

[9] https://ourworldindata.org/grapher/oil-proved-reserves

[10] https://www.oecd.org/publications/uranium-20725310.htm

[11] https://ourworldindata.org/grapher/natural-gas-proved-reserves

[12] https://en.wikipedia.org/wiki/Low-carbon_power

[13] https://www.andritz.com/hydro-en/hydronews/hydro-news-asia/laos

[14] https://en.wikipedia.org/wiki/List_of_largest_hydroelectric_power_stations

[15] https://www.andritz.com/hydro-en/hydronews/hydropower-africa/democratic-rep-congo

[16] https://www.imf.org/en/Publications/fandd/issues/2022/12/country-case-kenya-taps-the-earth-heat